<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/favicon_io/favicon.ico">
    <title>LaTeX2Canvas</title>
    <style>
      *{
        box-sizing: border-box;
      }

      body{
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      }

      main {
        display: flex;
        flex-direction: column;
        width: 100vw;
        max-width: 600px;
        margin: 0 auto;
      }

      label {
        margin-bottom: 0.5rem;
      }

      button {
        width: fit-content;
        margin: 1rem auto;
      }

      #copied{
        animation-duration: 1s;
        animation-name: disappear;
      }

      .embed{
        display: flex;
        flex-direction: column;
        margin: 1rem 0 2rem;
      }

      #embeddable{
        width: 100%;
        height: 3rem;
        padding: 0;
      }

      @keyframes disappear {
        from{
            opacity: 1;
        }
        to{
            opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Latex til Canvas</h1>
      <p>Bytt ut alle $-tegn i en LaTeX-tekst med \( og \).</p>
      <label for="textIn">Lim in LaTeX-koden i feltet under:</label>
      <textarea name="" rows="10" id="textIn"></textarea>
      <button id="transform">Omform</button>
      <label for="textOut">Resultat:</label>
      <textarea name="" rows="10" id="textOut" readonly></textarea>
      <button id="copy">Kopier resultat</button>
      <div class="embed">
        <label for="embeddable">Kopier koden under for å bygge inn (embedde) på en side.</label>
        <textarea name="" id="embeddable" contenteditable="false"><iframe src="https://espenraugstad.github.io/latextocanvas/embed/" width="100%" height="800"></iframe></textarea>
        <button id="copyEmbed">Kopier for innbygging</button>
      </div>
    </main>

    <dialog id="copied">
        <h2>Kopiert!</h2>
    </dialog>

    <script>
      const textIn = document.getElementById("textIn");
      const transform = document.getElementById("transform");
      const textOut = document.getElementById("textOut");
      const copy = document.getElementById("copy");
      const copied = document.getElementById("copied");
      const embeddable = document.getElementById("embeddable");
      const copyEmbed = document.getElementById("copyEmbed");

      transform.addEventListener("click", handleTransformation);
      copy.addEventListener("click", copyResult);
      copyEmbed.addEventListener("click", copyEmbedding);

      function handleTransformation() {
        let inputValue = textIn.value;
        let outputValue = "";
        let left = true;
        for (let char of inputValue) {
          //console.log(char);
          if (char === "$" && left) {
            outputValue += "\\(";
            left = !left;
          } else if (char === "$" && !left) {
            outputValue += "\\)";
            left = !left;
          } else {
            outputValue += char;
          }
        }
        textOut.value = outputValue;
      }
      
     async function copyResult(){
        await navigator.clipboard.writeText(textOut.value);
        copied.showModal();
        setTimeout(()=>{
            copied.close();
        }, 900);
      }

      async function copyEmbedding(){
        await navigator.clipboard.writeText(embeddable.value);
        copied.showModal();
        setTimeout(()=>{
            copied.close();
        }, 900);
      }
    </script>
  </body>
</html>
